<!DOCTYPE html>
<html>
<head>
<title>Reaction Kinetics Simulator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:"Segoe UI",sans-serif;
  background:#0b0b0b;
  color:#e0e0e0;
}
header{text-align:center;padding:15px;}

.wrapper{max-width:1200px;margin:auto;padding:10px;}

.controls{
  background:#121212;
  padding:20px;
  border-radius:10px;
  border:1px solid #222;
  margin-bottom:20px;
}

label{font-size:0.85rem;}
.value{float:right;color:#9cc9ff;}

.sim{
  display:flex;
  flex-wrap:wrap;
  gap:20px;
  justify-content:center;
}

canvas{
  background:white;
  border-radius:6px;
}

.legend{
  font-size:0.8rem;
  margin-top:10px;
}

@media(max-width:800px){
  .sim{flex-direction:column;}
}
</style>
</head>

<body>

<header>
<h2>Gas Phase Reaction Kinetics</h2>
</header>

<div class="wrapper">

<div class="controls">

<label>Initial concentration
<span class="value" id="A0v"></span></label>
<input type="range" id="A0" min="0.5" max="2" step="0.1" value="1">

<label>Rate constant k
<span class="value" id="kv"></span></label>
<input type="range" id="k" min="0.1" max="2" step="0.1" value="1">

<label>Temperature
<span class="value" id="Tv"></span></label>
<input type="range" id="T" min="0.5" max="3" step="0.1" value="1">

<label>Reaction order</label>
<select id="order">
<option value="0">Zero</option>
<option value="1" selected>First</option>
<option value="2">Second</option>
</select>

</div>

<div class="sim">
<canvas id="gas" width="550" height="340"></canvas>
<canvas id="graph" width="550" height="340"></canvas>
</div>

<div class="legend">
Blue = Reactant A, Red = Reactant B, Gray = Products
</div>

</div>

<script>

let gas=document.getElementById("gas");
let gctx=gas.getContext("2d");

let graph=document.getElementById("graph");
let ctx=graph.getContext("2d");

let particles=[];
let history=[];

/* ===== DISPLAY ===== */
function showValues(){
  A0v.innerText=A0.value;
  kv.innerText=k.value;
  Tv.innerText=T.value;
}

/* ===== SPEED DISTRIBUTION ===== */
function mbSpeed(T){
  return Math.sqrt(-Math.log(Math.random()))*T;
}

/* ===== INITIALIZE ===== */
function init(){
  particles=[];
  history=[];

  let N=Math.floor(120*parseFloat(A0.value));

  for(let i=0;i<N;i++){
    let speed=mbSpeed(parseFloat(T.value));

    particles.push({
      type: i<N/2 ? "A" : "B",
      x:Math.random()*530+10,
      y:Math.random()*320+10,
      vx:(Math.random()-0.5)*speed,
      vy:(Math.random()-0.5)*speed
    });
  }
}

document.querySelectorAll("input,select")
.forEach(el=>el.oninput=()=>{
  showValues();
  init();
});

showValues();
init();

/* ===== GRAPH ===== */
function axis(){
  ctx.strokeStyle="#000";
  ctx.beginPath();
  ctx.moveTo(40,300);
  ctx.lineTo(520,300);
  ctx.moveTo(40,300);
  ctx.lineTo(40,20);
  ctx.stroke();

  ctx.fillText("Time",250,325);

  ctx.save();
  ctx.translate(10,160);
  ctx.rotate(-Math.PI/2);
  ctx.fillText("Concentration",0,0);
  ctx.restore();
}

/* ===== SIMULATION ===== */
function update(){

  let kf=parseFloat(k.value);
  let Tval=parseFloat(T.value);
  let orderf=order.value;

  gctx.clearRect(0,0,550,340);

  let aliveA=particles.filter(p=>p.type=="A").length;
  let conc=aliveA/(particles.length/2);

  /* ===== TRUE RATE LAW ===== */
  let rate=0;

  if(orderf==0){
    rate=kf;
  }

  if(orderf==1){
    rate=kf*conc;
  }

  if(orderf==2){
    rate=kf*conc*conc;
  }

  let reactCount=Math.floor(rate*1.5);

  for(let n=0;n<reactCount;n++){
    let alive=particles.filter(p=>p.type=="A");

    if(alive.length){
      let r=alive[Math.floor(Math.random()*alive.length)];
      r.type="P";
    }
  }

  /* ===== MOTION ===== */
  let countA=0;

  for(let p of particles){

    p.x+=p.vx*Tval;
    p.y+=p.vy*Tval;

    if(p.x<5||p.x>545) p.vx*=-1;
    if(p.y<5||p.y>335) p.vy*=-1;

    if(p.type=="A"){
      countA++;
      gctx.fillStyle="#0077ff";
    }
    else if(p.type=="B"){
      gctx.fillStyle="#ff4444";
    }
    else{
      gctx.fillStyle="#888";
    }

    gctx.beginPath();
    gctx.arc(p.x,p.y,3,0,Math.PI*2);
    gctx.fill();
  }

  let newConc=countA/(particles.length/2);
  history.push(newConc);

  ctx.clearRect(0,0,550,340);
  axis();

  ctx.beginPath();
  ctx.strokeStyle="#0077ff";
  ctx.lineWidth=2;

  for(let i=0;i<history.length;i++){
    let x=40+i*2;
    let y=300-history[i]*250;

    if(i==0) ctx.moveTo(x,y);
    else ctx.lineTo(x,y);
  }

  ctx.stroke();
}

setInterval(update,40);

</script>

</body>
</html>
